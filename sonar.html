<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>revibe</title>
    <style>
        /* Basic styles for the application */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #2c3e50;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
            box-sizing: border-box;
        }

        .welcome-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: rgba(44, 62, 80, 0.8);
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            width: 400px;
            position: absolute;
        }

        .welcome-title {
            font-size: 36px;
            margin-bottom: 20px;
            color: #e74c3c;
        }

        .update-log {
            margin-bottom: 20px;
            font-size: 16px;
            color: #ecf0f1;
        }

        button {
            padding: 10px 20px;
            background-color: #3498db;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        .grid-container {
            position: relative;
            overflow: hidden;
            width: 800px;
            height: 800px;
            border: 2px solid #fff;
            margin-right: 10px;
            border-radius: 10px;
            display: none;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(40, 20px);
            grid-auto-rows: 20px;
            position: absolute;
            top: 0;
            left: 0;
        }

        .grid div {
            position: relative;
            width: 20px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid #2980b9;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer; /* Change cursor style to pointer */
        }

        .grid div:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }

        .player {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: rgba(46, 204, 113, 0.8);
            border-radius: 50%;
            transition: transform 0.2s ease;
            z-index: 1;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 220px;
        }

        #coordinates,
        #coins,
        #coinTimer {
            margin-top: 5px;
            font-size: 18px;
            text-align: center;
        }

        #resetButton {
            padding: 8px;
            background-color: #e74c3c;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
            font-size: 16px;
        }

        #resetButton:hover {
            background-color: #c0392b;
        }

        .tool-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            width: 100%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .tool-box h2 {
            margin: 0 0 5px 0;
            font-size: 18px;
            text-decoration: underline;
            color: #ecf0f1;
        }

        .emoji-list,
        .block-list {
            display: flex;
            justify-content: center;
            margin-top: 5px;
            flex-wrap: wrap;
        }

        .emoji-button,
        .block-button {
            cursor: pointer;
            margin: 2px;
            display: inline-block;
            width: 20px;
            height: 20px;
            transition: border 0.2s;
            font-size: 20px;
        }

        .emoji-button:hover,
        .block-button:hover {
            border: 2px solid #fff;
        }

        .delete-button {
            cursor: pointer;
            color: #e74c3c;
            margin-top: 5px;
            font-size: 28px;
        }

        input[type="file"] {
            display: none;
        }

        #addColorButton,
        #uploadMapButton,
        #addEmojiButton,
        #saveMapButton {
            margin-top: 5px;
            padding: 5px;
            background-color: #2980b9;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
        }

        #addColorButton:hover,
        #uploadMapButton:hover,
        #addEmojiButton:hover,
        #saveMapButton:hover {
            background-color: #1a5276;
        }

        .coin {
            font-size: 20px;
            color: gold;
            position: relative;
            z-index: 0;
        }

        .color-block {
            width: 20px;
            height: 20px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-title">Welcome to Revibe</div>
        <div class="update-log">
            <h3>Update Logs:</h3>
            <ul>
                <li>Version 1.0: Initial Release</li>
                <li>Version 1.1: Added custom emojis and block features.</li>
                <li>Version 1.2: Improved UI and functionality, added download/load maps feature, added portals and made it so you can go through doors </li>
                <li>Version 1.3: Added portal functionality.</li>
            
            </ul>
        </div>
        <button id="startButton">Play</button>
    </div>

    <div class="grid-container" id="gridContainer">
        <div class="grid" id="grid"></div>
        <div class="player" id="player"></div>
    </div>

    <div class="sidebar" id="sidebar">
        <div id="coordinates">Coordinates: (20, 20)</div>
        <div id="coins">Coins: 0</div>
        <div id="coinTimer">Next Coin in: 1200s</div>
        <div class="tool-box">
            <h2>Tools</h2>
            <div class="emoji-list" id="emojiList">
                <div class="emoji-button" data-emoji="üåô">üåô</div>
                <div class="emoji-button" data-emoji="‚≠ê">‚≠ê</div>
                <div class="emoji-button" data-emoji="üåπ">üåπ</div>
                <div class="emoji-button" data-emoji="üçø">üçø</div>
                <div class="emoji-button" data-emoji="‚õΩ">‚õΩ</div>
                <div class="emoji-button" data-emoji="üöò">üöò</div>
                <div class="emoji-button" data-emoji="üöî">üöî</div>
                <div class="emoji-button" data-emoji="üö™">üö™</div>
                <div class="emoji-button" data-emoji="üåÄ">üåÄ</div>
            </div>

            <h2>Blocks</h2>
            <div class="block-list" id="blockImageList">
                <div class="block-button" data-color="orange">
                    <img src="https://z0nyy.xyz/orange-drop.png" alt="Orange" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button" data-color="green">
                    <img src="https://z0nyy.xyz/green-drop.png" alt="Green" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button" data-color="blue">
                    <img src="https://z0nyy.xyz/blue-drop.png" alt="Blue" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button" data-color="red">
                    <img src="https://z0nyy.xyz/red-drop.png" alt="Red" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button" data-color="pink">
                    <img src="https://z0nyy.xyz/pink-block.png" alt="Pink" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button" data-color="black">
                    <img src="https://z0nyy.xyz/black-drop.png" alt="Black" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button" data-color="brown">
                    <img src="https://z0nyy.xyz/brown-drop.png" alt="Brown" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button" data-color="white">
                    <img src="https://z0nyy.xyz/white-drop.png" alt="White" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button" data-color="yellow">
                    <img src="https://z0nyy.xyz/yellow-drop.png" alt="Yellow" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/rainbow-mushroom.png" alt="Rainbow Mushroom" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/rainbow-block.png" alt="Rainbow Block" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/vice-block.png" alt="Vice Block" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/rain-flame.png" alt="Rain Flame" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/purple-custom.png" alt="Purple Custom" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/purple-bear.png" alt="Purple Bear" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/lion-bear.png" alt="Lion Bear" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/da-baby.png" alt="Da Baby" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/chrome-block.png" alt="Chrome Block" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/Ben.png" alt="Ben" style="width: 20px; height: 20px;" />
                </div>
                  <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/IMG_5876.jpeg" alt="pink bear" style="width: 20px; height: 20px;" />
                </div>
                <div class="block-button">
                    <img src="https://raw.githubusercontent.com/zelity/cw/refs/heads/main/images/IMG_0603.png" alt="black bear" style="width: 20px; height: 20px;" />
                </div>
                 <div class="block-button">
                    <img src="https://assets.sutori.com/user-uploads/image/76734e4b-1961-4d5b-b214-e63065fd98f0/144501e5d39ef72449cc1f11eb46f364.jpeg" alt="polyphemus" style="width: 20px; height: 20px;" />
                </div>
           <div class="block-button">
                    <img src="data:image/jpeg;base64,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" alt="aeolus" style="width: 20px; height: 20px;" />
                </div>
            <div class="block-button" data-color="white">
                    <img src="https://z0nyy.xyz/test-blue-square.webp" alt="White" style="width: 20px; height: 20px;" />
                </div>
                
            </div>

            <h2>Add Emoji</h2>
            <div class="emoji-input-container">
                <input type="text" id="emojiInput" placeholder="Enter Emoji (e.g., ‚≠ê)" />
                <button id="addEmojiButton">Add Emoji</button>
            </div>

            <h2>Create Color Block</h2>
            <div class="color-input-container">
                <input type="text" id="colorInput" placeholder="Hex code (e.g., #ABCDEF)" />
                <button id="addColorButton">Add Color</button>
            </div>

            <div class="delete-button" id="deleteButton">‚ùå</div>
            <button id="saveMapButton" class="upload-button">Save Map</button>
            <button id="uploadMapButton" class="upload-button">Upload Map</button>
            <input type="file" id="uploadMapInput" accept=".json" />
        </div>

        <button id="resetButton">Reset Map</button>
    </div>

    <script>
        // Show welcome screen initially
        document.getElementById('welcomeScreen').style.display = 'flex';
        document.getElementById('gridContainer').style.display = 'none';

        const localStorageKey = "customColorBlocks";

        // Start button functionality
        document.getElementById('startButton').addEventListener('click', function () {
            document.getElementById('welcomeScreen').style.display = 'none'; // Hide welcome screen
            document.getElementById('gridContainer').style.display = 'block'; // Show grid container
            startGame(); // Start the game
        });

        // Main game logic initialization
        function startGame() {
            const player = document.getElementById('player');
            const grid = document.getElementById('grid');
            const coordinatesDisplay = document.getElementById('coordinates');
            const coinsDisplay = document.getElementById('coins');
            const coinTimerDisplay = document.getElementById('coinTimer');
            const resetButton = document.getElementById('resetButton');

            // Load player position and portals from local storage, fallback to (20, 20)
            let position = JSON.parse(localStorage.getItem('playerPosition')) || { x: 20, y: 20 };
            let portals = JSON.parse(localStorage.getItem('portals')) || []; // Load portals
            let currentItem = ''; // Default item (block or emoji)
            let currentColor = ''; // Default color
            let currentEmoji = ''; // Default emoji
            let coins = 0; 
            let coinCountdown = 1200; // Countdown for next coin spawn set to 20 minutes (1200 seconds)
            let timerInterval;
            let currentCoin = null; // Variable to store the current coin element

            // Load custom color blocks from local storage
            let customColorBlocks = JSON.parse(localStorage.getItem(localStorageKey)) || [];

            // Create a larger grid (40x40)
            for (let i = 0; i < 1600; i++) {
                const cell = document.createElement('div');
                cell.addEventListener('click', function () {
                    // In delete mode, delete the block or emoji
                    if (this.dataset.filled) {
                        if (deleteMode) {
                            this.innerHTML = ''; // Clear previous content
                            delete this.dataset.filled; // Mark as empty
                            delete this.dataset.emoji; // Clear emoji dataset
                            delete this.dataset.colorBlock; // Clear color block dataset (if any)
                            saveMap(); // Save map state after deletion
                        }
                    } else {
                        // Place blocks or emojis
                        if (currentItem) {
                            const blockElement = document.createElement('img'); // Create an img for the block
                            blockElement.src = currentItem; // Set the block image source
                            blockElement.style.width = '20px'; // Set block size
                            blockElement.style.height = '20px'; // Set block size
                            this.innerHTML = ''; // Clear previous content
                            this.appendChild(blockElement); // Append block image
                            this.dataset.filled = 'true'; // Mark as filled
                        } else if (currentEmoji) {
                            const emojiElement = document.createElement('div'); // Create a div for the emoji
                            emojiElement.textContent = currentEmoji; // Set emoji text
                            emojiElement.style.fontSize = '20px'; // Set emoji size
                            this.innerHTML = ''; // Clear previous content
                            this.appendChild(emojiElement); // Append emoji to cell
                            this.dataset.filled = 'true'; // Mark as filled
                            this.dataset.emoji = currentEmoji; // Store emoji in dataset

                            // Add portal to the list if it's a spiral
                            if (currentEmoji === 'üåÄ') {
                                const portalCoords = { x: Math.floor(i % 40), y: Math.floor(i / 40) };
                                portals.push(portalCoords); // Add portal coordinates
                                localStorage.setItem('portals', JSON.stringify(portals)); // Update local storage
                            }
                        } else if (currentColor) {
                            const colorBlockElement = document.createElement('div'); // Create a div for the color block
                            colorBlockElement.style.backgroundColor = currentColor; // Set the background color
                            colorBlockElement.className = 'color-block'; // Add class for styling
                            this.innerHTML = ''; // Clear previous content
                            this.appendChild(colorBlockElement); // Append color block
                            this.dataset.filled = 'true'; // Mark as filled
                            this.dataset.colorBlock = currentColor; // Store the color for further usage
                        }

                        // Save to localStorage when a cell is placed
                        saveMap();
                    }
                });
                grid.appendChild(cell);
            }

            // Load previous map state from local storage
            loadMap();

            // Move player smoothly to their position
            function movePlayer(newPos) {
                player.style.transform = `translate(${(newPos.x * 20)}px, ${(newPos.y * 20)}px)`;
                position = newPos; // Update player position
                savePlayerPosition(); // Save player's position in local storage
            }

            // Spawn player at the loaded position
            movePlayer(position);

            // Update Coordinates and Timer on screen
            function updateDisplay() {
                coordinatesDisplay.textContent = `Coordinates: (${position.x}, ${position.y})`;
                coinsDisplay.textContent = `Coins: ${coins}`;
                coinTimerDisplay.textContent = `Next Coin in: ${coinCountdown}s`;
            }

            // Handle spawning coin
            function spawnCoin() {
                // Avoid generating coins in filled cells
                let coinPosition;
                do {
                    coinPosition = Math.floor(Math.random() * 1600);
                } while (grid.children[coinPosition].dataset.filled); // Ensure coin is not placed on a filled block

                currentCoin = grid.children[coinPosition];
                currentCoin.innerHTML = '<span class="coin">üí∞</span>'; // Place coin in the random position
                currentCoin.dataset.filled = true; // Mark as filled
                currentCoin.dataset.coin = 'true'; // Store coin dataset
            }

            // Countdown for new coin spawning
            function startCoinTimer() {
                timerInterval = setInterval(() => {
                    coinCountdown--;
                    if (coinCountdown <= 0) {
                        spawnCoin();
                        coinCountdown = 1200; // Reset the countdown to 20 minutes (1200 seconds)
                    }
                    updateDisplay();
                }, 1000); // Update every second
            }

            // Handle player movement
            document.addEventListener('keydown', function (event) {
                let newPos = { ...position };

                if (event.key === 'w' && position.y > 0) newPos.y--;
                else if (event.key === 's' && position.y < 39) newPos.y++;
                else if (event.key === 'a' && position.x > 0) newPos.x--;
                else if (event.key === 'd' && position.x < 39) newPos.x++;

                const targetCell = grid.children[newPos.y * 40 + newPos.x];

                // Allow the player to move through the door and the spiral portal
                if (!targetCell.dataset.filled || 
                    targetCell.dataset.emoji === 'üö™' || 
                    targetCell.dataset.emoji === 'üåÄ') {

                    // Check for coin collection
                    if (targetCell.dataset.coin) {
                        coins++; // Increase coin count
                        updateDisplay();
                        targetCell.innerHTML = ''; // Remove the coin from the grid
                        delete targetCell.dataset.filled; // Mark as empty
                        delete targetCell.dataset.coin; // Remove coin dataset
                    }

                    // Check for spiral teleportation
                    if (targetCell.dataset.emoji === 'üåÄ') {
                        const otherPortals = portals.filter(portal => !(portal.x === newPos.x && portal.y === newPos.y));
                        if (otherPortals.length > 0) {
                            movePlayer(newPos);
                            const randomPortal = otherPortals[Math.floor(Math.random() * otherPortals.length)];
                            setTimeout(() => {
                                movePlayer(randomPortal); // Teleport to the selected portal location
                            }, 0); // Immediately after
                            return; // Exit to prevent standard movement after teleport
                        }
                    }
                    movePlayer(newPos); // Move player to the new position
                }

                updateDisplay();
            });

            // Delete block or emoji functionality
            const deleteButton = document.getElementById('deleteButton');
            let deleteMode = false; // Variable to track delete mode

            deleteButton.addEventListener('click', function () {
                deleteMode = !deleteMode; // Toggle delete mode
                
                // Optionally provide visual feedback for delete mode activation
                deleteButton.style.color = deleteMode ? '#fff' : '#e74c3c'; // Change color
            });

            // Reset functionality
            resetButton.addEventListener('click', function () {
                Array.from(grid.children).forEach(cell => {
                    cell.innerHTML = '';
                    delete cell.dataset.filled; // Clear dataset for the reset
                    delete cell.dataset.emoji; // Clear emoji from dataset
                    delete cell.dataset.colorBlock; // Clear color block dataset
                    delete cell.dataset.coin; // Clear coin dataset
                });
                coins = 0; // Reset coins
                coinCountdown = 1200; // Reset coin timer
                position = { x: 20, y: 20 }; // Reset player position to (20, 20)
                movePlayer(position); // Move player to reset position
                updateDisplay();
                clearInterval(timerInterval); // Stop timer
                spawnCoin(); // Spawn new coin after reset
                startCoinTimer(); // Restart coin timer
                portals = []; // Reset portals
                localStorage.removeItem('mapData'); // Clear saved map data from local storage
                localStorage.removeItem('playerPosition'); // Clear saved player position
                localStorage.removeItem('portals'); // Clear portals from local storage
                localStorage.removeItem(localStorageKey); // Clear custom color blocks from local storage
            });

            // Block and emoji button functionality
            const blockButtons = document.querySelectorAll('.block-button');
            blockButtons.forEach(button => {
                button.addEventListener('click', function () {
                    currentItem = this.querySelector('img').src; // Get the image source from clicked block
                    currentEmoji = ''; // Clear emoji selection
                    currentColor = ''; // Clear color selection
                    deleteButton.style.color = '#e74c3c'; // Ensure delete mode is turned off
                    deleteMode = false; // Turn off delete mode when a block is selected
                });
            });

            const emojiButtons = document.querySelectorAll('.emoji-button');
            emojiButtons.forEach(button => {
                button.addEventListener('click', function () {
                    currentEmoji = this.dataset.emoji; // Get the emoji from clicked button
                    currentItem = ''; // Clear block selection
                    currentColor = ''; // Clear color selection
                    deleteButton.style.color = '#e74c3c'; // Ensure delete mode is turned off
                    deleteMode = false; // Turn off delete mode when an emoji is selected
                });
            });

            // Add Emoji functionality
            const addEmojiButton = document.getElementById('addEmojiButton');
            addEmojiButton.addEventListener('click', function () {
                const emojiCode = document.getElementById('emojiInput').value.trim();
                if (emojiCode) {
                    const emojiButton = document.createElement('div');
                    emojiButton.className = 'emoji-button';
                    emojiButton.dataset.emoji = emojiCode; // Store emoji in dataset
                    emojiButton.textContent = emojiCode; // Set emoji text
                    emojiButton.style.fontSize = '20px'; // Set emoji size
                    
                    // Adding click event to the new emoji button
                    emojiButton.addEventListener('click', function () {
                        currentEmoji = this.dataset.emoji; // Get the emoji from clicked button
                        currentItem = ''; // Clear block selection
                        currentColor = ''; // Clear color selection
                        deleteButton.style.color = '#e74c3c'; // Ensure delete mode is turned off
                        deleteMode = false; // Turn off delete mode when an emoji is selected
                    });

                    // Append the new emoji button to the emoji list
                    document.getElementById('emojiList').appendChild(emojiButton);
                    document.getElementById('emojiInput').value = ''; // Clear input field
                } else {
                    alert('Please enter an emoji.');
                }
            });

            // Color block addition
            const addColorButton = document.getElementById('addColorButton');
            addColorButton.addEventListener('click', function () {
                const colorCode = document.getElementById('colorInput').value.trim();
                const isValidHex = /^#[0-9A-F]{6}$/i.test(colorCode); // Regex to validate hex color

                if (isValidHex) {
                    // Create a new block using a div element with hex background color
                    const colorBlock = document.createElement('div');
                    colorBlock.style.width = '20px'; // Block width
                    colorBlock.style.height = '20px'; // Block height
                    colorBlock.style.backgroundColor = colorCode; // Set hex color
                    colorBlock.className = 'block-button'; // Optional: give it some similar styling

                    // Adding click event to place the color block
                    colorBlock.addEventListener('click', function () {
                        currentItem = ''; // Clear image selection
                        currentEmoji = ''; // Clear emoji selection
                        currentColor = colorCode; // Use color code for placement
                        deleteButton.style.color = '#e74c3c'; // Ensure delete mode is turned off
                        deleteMode = false; // Turn off delete mode
                    });

                    // Append the block to the toolbox
                    document.getElementById('blockImageList').appendChild(colorBlock);
                    customColorBlocks.push(colorCode); // Save the color block
                    localStorage.setItem(localStorageKey, JSON.stringify(customColorBlocks)); // Update local storage
                } else {
                    alert('Invalid hex code. Please use format: #FFFFFF');
                }
            });

            // Save the current state of the map to local storage
            function saveMap() {
                const mapData = Array.from(grid.children).map((cell) => ({
                    filled: cell.dataset.filled === 'true',
                    emoji: cell.dataset.emoji || null,
                    blockImage: cell.querySelector('img') ? cell.querySelector('img').src : null, // Capture block image
                    colorBlock: cell.dataset.colorBlock || null, // Capture color if exists
                    coin: cell.dataset.coin || null // Capture coin information
                }));

                localStorage.setItem('mapData', JSON.stringify(mapData));
            }

            // Load the previous map state from local storage
            function loadMap() {
                const savedMapData = localStorage.getItem('mapData');
                if (savedMapData) {
                    const mapData = JSON.parse(savedMapData);
                    // Clear the grid before loading the new map
                    Array.from(grid.children).forEach(cell => {
                        cell.innerHTML = ''; // Clear all cells
                        delete cell.dataset.filled; // Clear filled status
                        delete cell.dataset.emoji; // Clear emoji from dataset
                        delete cell.dataset.colorBlock; // Clear color block dataset
                        delete cell.dataset.coin; // Clear coin dataset
                    });

                    // Populate grid with the uploaded data
                    mapData.forEach((cellData, index) => {
                        const cell = grid.children[index];
                        if (cellData.filled) {
                            cell.dataset.filled = 'true';
                            if (cellData.emoji) {
                                const emojiElement = document.createElement('div');
                                emojiElement.textContent = cellData.emoji; // Set emoji text
                                emojiElement.style.fontSize = '20px'; // Set emoji size
                                cell.appendChild(emojiElement); // Append emoji to cell
                                cell.dataset.emoji = cellData.emoji; // Store the emoji in the dataset
                            } else if (cellData.blockImage) {
                                const blockElement = document.createElement('img'); // Create an img for the block
                                blockElement.src = cellData.blockImage; // Set the block image source
                                blockElement.style.width = '20px'; // Set block size
                                blockElement.style.height = '20px'; // Set block size
                                cell.appendChild(blockElement); // Append the block image
                            } else if (cellData.colorBlock) {
                                const colorBlockElement = document.createElement('div'); // Create a div for the color block
                                colorBlockElement.style.backgroundColor = cellData.colorBlock; // Set the background color
                                colorBlockElement.className = 'color-block'; // Add class for styling
                                colorBlockElement.style.width = '20px'; // Block width
                                colorBlockElement.style.height = '20px'; // Block height
                                cell.appendChild(colorBlockElement); // Append the color block
                            }
                        }
                        // Load coins if they exist
                        if (cellData.coin) {
                            cell.innerHTML = '<span class="coin">üí∞</span>'; // Append the coin UI
                            cell.dataset.filled = true; // Mark as filled
                            cell.dataset.coin = 'true'; // Store coin dataset
                        }
                    });

                    // After uploading the map, check the player's position
                    checkPlayerPosition();
                }
                // Load custom color blocks into the toolbox
                customColorBlocks.forEach(color => {
                    const colorBlock = document.createElement('div');
                    colorBlock.style.width = '20px'; // Block width
                    colorBlock.style.height = '20px'; // Block height
                    colorBlock.style.backgroundColor = color; // Set hex color
                    colorBlock.className = 'block-button'; // Optional: give it some similar styling
                    // Adding click event to support block placing
                    colorBlock.addEventListener('click', function () {
                        currentItem = ''; // Clear image selection
                        currentEmoji = ''; // Clear emoji selection
                        currentColor = color; // Use color code for placement
                        deleteButton.style.color = '#e74c3c'; // Ensure delete mode is turned off
                        deleteMode = false; // Turn off delete mode
                    });
                    document.getElementById('blockImageList').appendChild(colorBlock);
                });
            }

            // Check and adjust player position if they are inside a block
            function checkPlayerPosition() {
                const playerCell = grid.children[position.y * 40 + position.x];
                if (playerCell.dataset.filled) {
                    // Find the first empty cell to relocate the player
                    for (let i = 0; i < grid.children.length; i++) {
                        if (!grid.children[i].dataset.filled) {
                            position.x = i % 40; // Calculate new x position
                            position.y = Math.floor(i / 40); // Calculate new y position
                            movePlayer(position); // Move player to this empty position
                            break; // Exit loop after finding the first empty cell
                        }
                    }
                }
            }

            // Save the map to a JSON file
            document.getElementById('saveMapButton').addEventListener('click', function () {
                const mapData = localStorage.getItem('mapData');
                if (mapData) {
                    const blob = new Blob([mapData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'map.json'; // File name for download
                    a.click();
                    URL.revokeObjectURL(url);
                } else {
                    alert('No map data available to save.');
                }
            });

            // Upload map functionality
            document.getElementById('uploadMapButton').addEventListener('click', function () {
                document.getElementById('uploadMapInput').click(); // Trigger file input
            });

            // Load a map from a JSON file
            document.getElementById('uploadMapInput').addEventListener('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const uploadedData = JSON.parse(e.target.result);
                        
                        // Clear the current map
                        Array.from(grid.children).forEach(cell => {
                            cell.innerHTML = '';
                            delete cell.dataset.filled; // Clear dataset
                            delete cell.dataset.emoji; // Clear emoji from dataset
                            delete cell.dataset.colorBlock; // Clear color block dataset
                            delete cell.dataset.coin; // Clear coin dataset
                        });

                        // Populate grid with the uploaded data
                        uploadedData.forEach((cellData, index) => {
                            const cell = grid.children[index];
                            if (cellData.filled) {
                                cell.dataset.filled = 'true';
                                if (cellData.emoji) {
                                    const emojiElement = document.createElement('div');
                                    emojiElement.textContent = cellData.emoji; // Set emoji text
                                    emojiElement.style.fontSize = '20px'; // Set emoji size
                                    cell.appendChild(emojiElement); // Append emoji
                                    cell.dataset.emoji = cellData.emoji; // Store emoji in dataset
                                } else if (cellData.blockImage) {
                                    const blockElement = document.createElement('img'); // Create an img for the block
                                    blockElement.src = cellData.blockImage; // Set the block image source
                                    blockElement.style.width = '20px'; // Set block size
                                    blockElement.style.height = '20px'; // Set block size
                                    cell.appendChild(blockElement); // Append the block image
                                } else if (cellData.colorBlock) {
                                    const colorBlockElement = document.createElement('div'); // Create a div for the color block
                                    colorBlockElement.style.backgroundColor = cellData.colorBlock; // Set the background color
                                    colorBlockElement.className = 'color-block'; // Add class for styling
                                    colorBlockElement.style.width = '20px'; // Block width
                                    colorBlockElement.style.height = '20px'; // Block height
                                    cell.appendChild(colorBlockElement); // Append the color block
                                }
                            }
                            // Load coins if they exist
                            if (cellData.coin) {
                                cell.innerHTML = '<span class="coin">üí∞</span>'; // Append the coin UI
                                cell.dataset.filled = true; // Mark as filled
                                cell.dataset.coin = 'true'; // Store coin dataset
                            }
                        });

                        updateDisplay(); // Update the display after loading the new map
                        // Reload portals from local storage to ensure they work post-upload
                        portals = JSON.parse(localStorage.getItem('portals')) || [];
                        saveMap(); // Save to local storage for safety
                        // Check and adjust player position if necessary
                        checkPlayerPosition();
                    };
                    reader.readAsText(file);
                }
            });

            // Save player position to localStorage
            function savePlayerPosition() {
                localStorage.setItem('playerPosition', JSON.stringify(position));
            }

            // Start the coin timer when the game starts
            startCoinTimer();
        }
    </script>
</body>
</html>
     
